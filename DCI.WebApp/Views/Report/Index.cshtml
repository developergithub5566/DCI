@* @model IEnumerable<DCI.Models.ViewModel.DocumentViewModel>*@
@using Newtonsoft.Json;
@using DCI.Core.Common;
@using DCI.Models.ViewModel; 

<link href="~/css/DCIcustom.css" rel="stylesheet" />
<style>


    .custom-file-label {
        padding: 8px 16px;
        background-color: #007bff;
        color: white;
        border-radius: 4px;
        cursor: pointer;
    }

    .file-name {
        margin-left: 10px;
        font-style: italic;
    }

</style>

@{
    var modulePageAccess = Context.Session.GetString("ModulePageAccess");

    var canView = false;
    var canAdd = false;
    var canEdit = false;
    var canDelete = false;

    if (modulePageAccess == null)
    {
        <script>
            $.ajax({
                type: 'POST',
                url: '@Url.Action("Logout", "Account")',
                success: function (response) {

                    Swal.fire({
                        text: "Your session has timed out. Please log in again.",
                        icon: "info",
                        confirmButtonText: "Ok"
                    }).then((result) => {
                        window.location.href = '/Account/Logout';
                    });
                },
                error: function () {
                    Swal.fire({
                        text: "An error occurred. Please try again.",
                        icon: "error"
                    });
                }
            })
        </script>
    }
    else
    {
        var module = JsonConvert.DeserializeObject<List<ModuleInRoleViewModel>>(modulePageAccess)?
                        .FirstOrDefault(x => x.ModulePageId == (int)EnumModulePage.Document);
        canView = module?.View ?? false;
        canAdd = module?.Add ?? false;
        canEdit = module?.Update ?? false;
        canDelete = module?.Delete ?? false;
    }
}

<div class="container-fluid">
    <div class="spinner-overlay">
        <div class="spinner-border text-light" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>



    <div class="d-sm-flex align-items-center justify-content-between mb-3">
        <h6 class="m-0 font-weight-bold text-gray-800">Reports</h6>
        <div class="upperRightDivBtn">
            @*        <a href="#" title="Add Document" class="btn btnPrimary btn-icon-split @(canAdd ? "" : "disabled")" data-toggle="modal" data-target="#" onclick="newForm()">
            <span class="icon text-white"><i class="fa-solid fa-plus text-xs"></i></span>
            <span class="text text-white"><small>Add Document</small></span>
            </a> *@
            @*    <label for="DocTypeId" class="col-form-label required">Document Type:</label> *@
            <select id="statusSelect" class="form-select">
                <option value="0">select status</option>
                <option value="1">In Progress</option>
                <option value="2">For Review</option>
                <option value="3">For Approval</option>
                <option value="4">Approved</option>
            </select>

        </div>

    </div>
    <div class="col-12 p0">
        <ul class="breadcrumb">
            <li><a href="~/Home/Index">Dashboard</a></li>
            <li>Report</li>
        </ul>
    </div>

    <div class="card shadow mb-4">
        <div class="card-header">
            <label class="mb0">Data</label>
        </div>
        <div class="card-body">
            <div class="table-responsive mt20">
                <table class="table table-bordered nowrap" id="tblDocument" width="100%" cellspacing="0">
                    <thead>
                        <tr>
                            @* 	<th>
                            <label>Id</label>
                            </th> *@
                            <th>
                                <label>Document No</label>
                            </th>
                            <th>
                                <label>Document Name</label>
                            </th>
                            <th>
                                <label>Document Type</label>
                            </th>
                            <th>
                                <label>Date Created</label>
                            </th>
                            <th>
                                <label>Status</label>
                            </th>
                            <th>
                                <label>Prepared By</label>
                            </th>
                            @* <th>
                            Action
                            </th> *@
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                  
                    </tbody>
                </table>
            </div>
            </<div>
            </div>


        </div>
        @section scripts {

          @*   <script src="https://cdn.datatables.net/2.1.2/js/dataTables.js"></script>

            <script src="https://cdn.datatables.net/buttons/3.2.1/js/dataTables.buttons.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
            <script src="https://cdn.datatables.net/buttons/3.2.1/js/buttons.html5.min.js"></script>
            <script src="https://cdn.datatables.net/buttons/3.2.1/js/buttons.print.min.js"></script>

            <link rel="stylesheet" href="https://cdn.datatables.net/2.2.2/css/dataTables.dataTables.css">
            <link rel="stylesheet" href="https://cdn.datatables.net/buttons/3.2.1/css/buttons.dataTables.css"> *@

            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
            <script type="text/javascript">
                var js = jQuery.noConflict(true);

                $('.spinner-overlay').show();

                setTimeout(() => {
                    $('.spinner-overlay').hide();
                }, 200);

                alert("ok");
                $(document).ready(function () {
                    alert("ok");
                    loadData();

                    js('#tblDocument').DataTable({
                        layout: {
                            topStart: {
                                buttons: [

                                    {
                                        extend: 'excel',
                                        text: 'Excel',
                                        title: 'Document Report',
                                        exportOptions: {
                                            columns: ':not(:last-child)' // Excludes the last column
                                        }
                                    },
                                    {
                                        extend: 'pdf',
                                        text: 'PDF',
                                        title: 'Document Report',
                                        exportOptions: {
                                            columns: ':not(:last-child)' // Excludes the last column
                                        }
                                    }

                                ]
                            }
                        }
                    });

                    document.getElementById("statusSelect").addEventListener("change", function (event) {

                        const statusId = document.getElementById('statusSelect').value;

                        loadData()
                   });
                });

                function loadData() {
                    alert("ok")

                    $.ajax({
                        url: "/Document/Index",
                        type: "GET",
                        dataType: "json",
                       // data: { StatusId: statusId },
                        success: function (response) {
                            populateTable(response);
                        },
                        error: function (xhr, status, error) {
                            console.error("Error fetching data:", error);
                        }
                    });
                }

                function populateTable(data) {
                    var tableBody = $("#tableBody");
                    tableBody.empty(); // Clear existing data

                    if (data.length === 0) {
                        tableBody.append("<tr><td colspan='7' class='text-center'>No records found</td></tr>");
                        return;
                    }

                    $.each(data, function (index, item) {
                        var row = `<tr>
                                                <td>${item.docNo}</td>
                                                                <td>${item.docName}</td>
                                                                <td>${item.docTypeId}</td>
                                                                <td>${item.docTypeName}</td>
                                                                <td>${item.statusName}</td>
                                                                <td>${item.createdName}</td>
                               
                            </tr>`;
                        tableBody.append(row);
                    });
                }
            </script>
        }
@*         <td>${item.DocNo}</td>
        <td>${item.DocName}</td>
        <td>${item.DocTypeName}</td>
        <td>${item.DateCreated}</td>
        <td>${item.StatusName}</td>
        <td>${item.CreatedName}</td> *@
