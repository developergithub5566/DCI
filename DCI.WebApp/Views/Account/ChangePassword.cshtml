@model DCI.Models.ViewModel.ChangePasswordViewModel
<link href="~/css/login-custom.css" rel="stylesheet" />

<div class="loginBG">
	<div class="spinner-overlay">
		<div class="spinner-border text-light" role="status">
			<span class="visually-hidden">Loading...</span>
		</div>
	</div>

	<div class="gap gap-lg"></div>
	<div class="container">
		<div class="row">
			<div class="offset-xl-4 offset-lg-3 offset-md-2 offset-1 col-xl-4 col-lg-6 col-md-8 col-10">
				<div class="loginDiv">
					<form id="ChangePasswordForm" method="post">

					@* 	<div class="form-group">
							<label>Current Password</label>
							<input type="password" class="form-control" id="CurrentPassword" name="CurrentPassword" placeholder="Current Password">
							<span asp-validation-for="CurrentPassword" class="text-danger" type="password"></span>
						</div> *@
						<div class="form-group">
							<label>New Password</label>
							<input type="password" class="form-control" id="NewPassword" name="NewPassword" placeholder="New Password">
							<span asp-validation-for="NewPassword" class="text-danger"></span>
						</div>

						<div class="form-group">
							<label>Confirm Password</label>
							<input type="password" class="form-control" id="ConfirmPassword" name="ConfirmPassword" placeholder="Confirm Password">
							<span asp-validation-for="ConfirmPassword" class="text-danger" type="password"></span>
						</div>

				@* 		<div class="form-group">
							<ul>
								<li>At least 8 characters</li>
								<li>At least one uppercase letter</li>
								<li>At least one lowercase letter</li>
								<li>At least one digit</li>
								<li>At least one special character</li>
							</ul>
						</div> *@

						<input type="hidden" name="IsResetPassword" id="IsResetPassword" value="true" />
						<input type="hidden" asp-for="Email" id="Email" />
						@*          <input type="hidden" asp-for="Token" /> *@

						<button type="submit" class="btn btn-primary">Change Password</button>
					</form>
					<div class="copyrights">
						<label>&copy; 2024 DBP Data Center Inc.</label>
					</div>
				</div>
			</div>
		</div>
	</div>

	@section Scripts {
@* 		<script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.5.2/bootbox.min.js"></script> *@
	@* 	@{
			await Html.RenderPartialAsync("_ValidationScriptsPartial");
		} *@
		<script type="text/javascript">
			$('.spinner-overlay').hide();


			$(document).ready(function () {

				$('#ChangePasswordForm').submit(function (event) {
					            $('.spinner-overlay').hide();

					event.preventDefault();
					var formData = $(this).serialize();

					// $.ajax({
					// 	type: 'POST',
					// 	url: '@Url.Action("ChangePassword", "Account")',
					// 	data: formData,
					
					// 	success: function (response) {
					// 		if (response.success) {							
					// 			bootbox.alert(response.message, function () {
					// 				location.reload();
					// 			});
					// 		} else {
					// 			bootbox.alert(response.message);
					// 		}
					// 	},
					// 	error: function () {
					// 		bootbox.alert('An error occurred. Please try again.');
					// 	}
					// });
					Swal.fire({
						text: "Are you sure you want to change your password?",
						icon: "warning",
						showCancelButton: true,
						confirmButtonText: "Ok"
					}).then((result) => {
						if (result.isConfirmed) {
							   $('.spinner-overlay').show();

							$.ajax({
								type: 'POST',
								url: '@Url.Action("ChangePassword", "Account")',
								data: formData,
								success: function (response) {
									if (response.success) {
										Swal.fire({
											text: response.message,
											icon: "success",
											confirmButtonText: "Ok"
										}).then((result) => {
											window.location = "/Account/Login";
										});
									} else {
										Swal.fire({
											text: response.message,
											icon: "error"
										});
									}
									$('.spinner-overlay').hide();
								},
								error: function () {
									$('.spinner-overlay').hide();
									Swal.fire({
										text: "An error occurred. Please try again.",
										icon: "error"
									});
								}
							});
						}
					});

				});//submit
			});
		</script>
	}
