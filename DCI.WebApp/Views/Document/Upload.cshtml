@model DCI.Models.ViewModel.DocumentViewModel


<style>
	/* input[type=file]::file-selector-button {
						border: 2px solid #6c5ce7;
						padding: .2em .4em;
						border-radius: .2em;
						background-color: #a29bfe;
						transition: 1s;
					}

						input[type=file]::file-selector-button:hover {
							background-color: #81ecec;
							border: 2px solid #00cec9;
						} */

</style>

@* <div class="container">
	<form id="createForm">
		<input type="hidden" id="DocId" name="DocId" value="@Model.DocId" >
		<div class="row">
			<div class="col-md-4">
				<label for="DocNo" class="col-form-label">Document No:</label>
				<input type="text" class="form-control" id="DocNo" name="DocNo" value="@Model.DocNo" disabled>
			</div>
		</div>
		<div class="row">
			<div class="col-md-4">
				<label for="DocName" class="col-form-label">Document Name:</label>
				<input type="text" class="form-control" id="DocName" name="DocName" value="@Model.DocName" disabled>
			</div>
		</div>
		<div class="row">
			<div class="col-md-4">
				<label for="DocName" class="col-form-label">Upload:</label>
				<input type="file" class="form-control" id="fileUpload" name="fileUpload" />
			</div>
		</div>
		<br />
		<div class="row">
			<div class="col-md-4">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				<button type="submit" class="btn btn-primary">Submit</button>
			</div>
		</div>
	</form>
</div> *@
<div class="loginBG">
	<div class="gap gap-lg"></div>
	<div class="container">
		<div class="row">
			<div class="offset-xl-4 offset-lg-3 offset-md-2 offset-1 col-xl-4 col-lg-6 col-md-8 col-10">
				<div class="loginDiv">
					<label class="title">Please upload your file</label>
					@* <p class="desc">Enter your email below to reset your password</p> *@

					<form id="createForm" method="post">
						<input type="hidden" id="DocId" name="DocId" value="@Model.DocId">
						<input type="hidden" id="RequestById" name="RequestById" value="@Model.RequestById">

						<div class="form-group">
							<label for="DocNo" class="col-form-label">Document No:</label>
							<input type="text" class="form-control" id="DocNo" name="DocNo" value="@Model.DocNo" readonly />
						</div>
						<div class="form-group">
							<label for="DocName" class="col-form-label">Document Name:</label>
							<input type="text" class="form-control" id="DocName" name="DocName" value="@Model.DocName" readonly />
						</div>

						<div class="form-group">
							<label for="DocName" class="col-form-label required">Document File:</label>
							<input type="file" class="form-control" id="fileUpload" name="fileUpload" accept="application/pdf" onchange="validateFileType()" required />
						</div>

						<div class="form-group">
							<button type="submit" class="btn btn-primary btn-block w-100">Submit</button>
						</div>
					</form>
				</div>



			</div>
			<div class="copyrights">
				<label>&copy; 2024 DBP Data Center Inc.</label>
			</div>
		</div>
	</div>
</div>
</div>

@section scripts {
@* 	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.5.2/bootbox.min.js"></script> *@
	@* <script src="~/js/file-upload.js"></script> *@

	<script type="text/javascript">
		// var js = jQuery.noConflict(true);

		$(document).ready(function () {


			// $('#fileUpload').on('change', function () {
			// 	var fileName = this.files[0] ? this.files[0].name : 'No file chosen';
			// 	document.querySelector('.file-name').textContent = '';

			// 	const newrecord = $('#DocId').val();

			// 	if (newrecord != 0) {
			// 		$('.file-name').text(fileName);
			// 	}

			// });

			$('#createForm').submit(function (event) {
				event.preventDefault();


				const fileInput = document.getElementById('fileUpload');
				const file = fileInput.files[0];
				const docId = $('#DocId').val();
				const docNo = $('#DocNo').val();
				const reqId = $('#RequestById').val();

				const formData = new FormData();
				formData.append('DocId', docId);
				formData.append('DocNo', docNo);
				formData.append('RequestById', reqId);
				formData.append('DocFile', file);
				
				Swal.fire({
					text: "Are you sure you want to submit this record?",
					icon: "question",
					showCancelButton: true,
					confirmButtonText: "Ok"
				}).then((result) => {
					if (result.isConfirmed) {

						$.ajax({
							type: 'POST',
							url: '@Url.Action("UploadFile", "Document")',
							data: formData,
							processData: false,
							contentType: false,
							success: function (response) {
								if (response.success) {
									

									Swal.fire({
										text: response.message,
										icon: "success",
										confirmButtonText: "Ok"
									}).then((result) => {
										window.location = "/Account/Login";
									});

								} else {
									Swal.fire({
										text: response.message,
										icon: "error"
									});
								}
							},
							error: function () {
								Swal.fire({
									text: "An error occurred. Please try again.",
									icon: "error"
								});
							}
						});
					}
				});
			});

		});

		function validateFileType() {
			const input = document.getElementById('fileUpload');
			const file = input.files[0];

			if (file) {
				if (file.type !== "application/pdf") {	
					input.value = '';
					Swal.fire({
						text: "Invalid file type. Please select a PDF file.",
						icon: "error"
					});
				}
			}
		}
	</script>
}
