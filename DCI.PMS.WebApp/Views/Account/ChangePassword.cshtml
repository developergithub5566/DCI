@{
	Layout = null;
}

@model DCI.Models.ViewModel.ChangePasswordViewModel
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>DCI</title>
	@* 	<script src="/lib/jquery/dist/jquery.min.js"></script> *@
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">


	@*     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script src="/lib/jquery/dist/jquery.min.js"></script>
    <script src="https://cdn.datatables.net/2.1.2/js/dataTables.js"></script> *@

	<link rel="stylesheet" href="https://cdn.datatables.net/2.1.2/css/dataTables.dataTables.css" />

	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet" />

	<link href="/css/ess/main-responsive.css" rel="stylesheet" />
	<link href="/css/ess/main.css" rel="stylesheet" />
	<link href="/css/ess/main-extension.css" rel="stylesheet" />
	<link href="/css/ess/ess-custom.css" rel="stylesheet" />
	<link href="/css/ess/login-custom.css" rel="stylesheet" />
	<link href="/css/ess/modstrap.css" rel="stylesheet" />
	<link rel=”stylesheet” href=”https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css” /> @* eye icon password *@
</head>



<div class="loginBG">
	<div class="spinner-overlay">
		<div class="spinner-border text-light" role="status">
			<span class="visually-hidden">Loading...</span>
		</div>
	</div>




	<div class="gap gap-lg"></div>
	<div class="container">
		<div class="row">
			<div class="offset-xl-4 offset-lg-3 offset-md-2 offset-1 col-xl-4 col-lg-6 col-md-8 col-10">
				<div class="loginDiv">
					<form id="ChangePasswordForm" method="post">
						@Html.AntiForgeryToken()
						@* 	<div class="form-group">
							<label>Current Password</label>
							<input type="password" class="form-control" id="CurrentPassword" name="CurrentPassword" placeholder="Current Password">
							<span asp-validation-for="CurrentPassword" class="text-danger" type="password"></span>
						</div> *@
						<input type="hidden" name="Email" id="Email" value="@ViewBag.Email" />
						<div class="form-group">
							<label>New Password</label>

							<input type="password" class="form-control" id="NewPassword" name="NewPassword" placeholder="New Password">
							<span asp-validation-for="NewPassword" class="text-danger"></span>
						</div>

						<div class="form-group">
							<label>Confirm Password</label>
							<input type="password" class="form-control" id="ConfirmPassword" name="ConfirmPassword" placeholder="Confirm Password">
							<span asp-validation-for="ConfirmPassword" class="text-danger" type="password"></span>
						</div>
						<div class="form-group" id="requiremnts" style="font-size:small">
							<ul>
								<li>At least 14 characters</li>
								<li>At least one uppercase letter</li>
								<li>At least one lowercase letter</li>
								<li>At least one numeral</li>
								<li>At least one special character</li>
							</ul>
						</div>


						<input type="hidden" name="IsResetPassword" id="IsResetPassword" value="true" />
						<input type="hidden" asp-for="Email" id="Email" />
						@*          <input type="hidden" asp-for="Token" /> *@

						@* 	<button type="submit" class="btn btn-primary">Change Password</button> *@
						<button type="submit" class="btn btn-primary btn-block w-100" onclick="ChangePassword(event)">Change Password</button>
					</form>
					<div class="copyrights">
						<label>&copy; @DateTime.Now.Year DBP Data Center Inc.</label>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script>
		$('.spinner-overlay').hide();

		$(document).ready(function () {
				setTimeout(() => {
					$('.spinner-overlay').hide();
				}, 200);
		});
	</script>

	<script>
			function ChangePassword(event){
				event.preventDefault();
						//var formData = $(this).serialize();
								   const newpass = $('#NewPassword').val();
									 const confirmpass = $('#ConfirmPassword').val();
											  const email = $('#Email').val();

			 let token = $('input[name="__RequestVerificationToken"]').val();

								 // var formData = $(this).serialize();
								 const formData = new FormData();
										 formData.append('NewPassword', newpass);
													 formData.append('ConfirmPassword', confirmpass);
										 formData.append('Email', email);
										 formData.append('CurrentPassword', "x");
												 formData.append('IsResetPassword', true);
															  // formData.append('__RequestVerificationToken', token);
						Swal.fire({
							text: "Are you sure you want to change your password?",
							icon: "warning",
							showCancelButton: true,
							confirmButtonText: "Ok"
						}).then((result) => {
							if (result.isConfirmed) {
								   $('.spinner-overlay').show();

								$.ajax({
									type: 'POST',
									url: '@Url.Action("HomeChangePassword", "Account")',
									data: formData,
										 processData: false,
												 contentType: false,
									success: function (response) {
											// alert(response)
											//   console.log(response);
											// debugger;

										if (response.success) {
											Swal.fire({
												text: response.message,
												icon: "success",
												confirmButtonText: "Ok"
											}).then((result) => {
												window.location = "/Account/Login";
											});
										} else {


												Swal.fire({
												text: response.message,
												icon: "error"
											});
										}
										$('.spinner-overlay').hide();
									},
									error: function () {
										$('.spinner-overlay').hide();
										Swal.fire({
											text: "An error occurred. Please try again.",
											icon: "error"
										});
									}
								});
							}
						});
		}
	</script>

