@model DCI.PMS.Models.ViewModel.ProjectViewModel
@using Newtonsoft.Json;
@using DCI.Core.Common;
@using DCI.Models.ViewModel;

<link href="~/css/dcicustom.css" rel="stylesheet" />


<div class="container-fluid">
    <div class="spinner-overlay">
        <div class="spinner-border text-light" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
    <div class="d-sm-flex align-items-center justify-content-between mb-3">
        <h6 class="m-0 font-weight-bold text-gray-800">Project Overview</h6>

    </div>
    <div class="col-12 p0">
        <ul class="breadcrumb">
            <li><a href="~/Home/Index">Dashboard</a></li>
            <li><a href="~/Project/Index">Project</a></li>
            <li><a href="~/Project/CreateEdit">Overview</a></li>

        </ul>
    </div>

    <div class="card shadow mb-4">
    
            <div class="bg-white border rounded shadow-sm p-4">

                    <!-- PROJECT HEADER -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-body">

                            <h3 class="fw-bold mb-1">Project Management System</h3>
                            <div class="text-muted mb-3">@Model.ClientName</div>

                            <div class="row small">
                            <div class="col-md-3"><strong>Project No:</strong> @Model.ProjectNo</div>
                        <div class="col-md-3"><strong>NOA Date:</strong> @Model.NOADate.ToString("MMM dd yyyy") <i class="fa-solid fa-paperclip me-1" title="download noa"></i></div>
                        <div class="col-md-3"><strong>NTP Date:</strong> @Model.NTPDate.ToString("MMM dd yyyy") <i class="fa-solid fa-paperclip me-1" title="download ntp"></i></div>
                        <div class="col-md-3"><strong>MOA Date:</strong> @Model.MOADate.ToString("MMM dd yyyy") <i class="fa-solid fa-paperclip me-1" title="download moa"></i></div>
                        <div class="col-md-3"><strong>Payment Mode:</strong> @Model.ModeOfPaymentName</div>
                                <div class="col-md-3"><strong>Project Duration:</strong> @Model.ProjectDuration</div>
                                <div class="col-md-3">
                                    <strong>Status:</strong>
                                    <span class="badge bg-primary">@Model.StatusName</span>
                                </div>
                            </div>

                          <hr>
                            <!-- PROJECT ATTACHMENTS -->
                            <div class="mb-4">
                             <strong>Project Attachments</strong>
                                <ul class="list-unstyled small mb-0">
                         
                                    @foreach(var attach in Model.AttachmentList.Where(x => x.MileStoneId == 0 && x.DeliverableId == 0))
                                    {
                                     <li>
                                            <i class="fa-solid fa-paperclip me-1"></i>
                                            <a href="#" class="text-decoration-none">
                                                attach.Filename.pdf
                                            </a>
                                    </li>
                            }
                        </ul>
                            </div>
                         
                        </div>
                
                    </div>
               


                    <!-- MILESTONES -->
                    <div class="card shadow-sm">
                        <div class="card-header fw-bold">
                            Project Milestones
                        </div>

                        <div class="card-body">

                            @foreach(var x in Model.MilestoneList)
                            {
                        <div class="mb-4 border-start border-4 ps-3">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="fw-bold mb-1">
                                     @x.MilestoneName
                                        <span class="badge bg-info ms-2">@x.Percentage%</span>
                                    </h6>
                                    <div class="small text-muted">
                                        Target Date: @x.TargetCompletedDate?.ToString("MMM dd yyyy")
                                    </div>
                                    <div class="small text-muted">
                                        Actual Completion Date: @x.ActualCompletionDate?.ToString("MMM dd yyyy")
                                    </div>
                                </div>
                                <span class="badge bg-success">@x.StatusName</span>
                            </div>
                            <!-- MILESTONE ATTACHMENTS -->
                            <div class="mt-2">
                               
                                <ul class="list-unstyled small mb-2">
                                    @foreach (var m in Model.AttachmentList.Where(y => y.MileStoneId == x.MileStoneId))
                                    {
                                        <li>
                                            <i class="fa-solid fa-paperclip me-1"></i>
                                            <a href="#" class="text-decoration-none">
                                              @m.Filename
                                            </a>
                                        </li>
                                    }
                                 
                                </ul>
                            </div>

                            <!-- DELIVERABLES -->
                       
                            <ul class="mt-2 mb-0 small">
                                @foreach(var d in x.DeliverableList.Where(r => r.MileStoneId == x.MileStoneId).ToList())
                                {
                                    <li>
                                        @d.DeliverableName
                                        <span class="badge bg-success ms-2">@d.StatusName</span>
                                        <!-- DELIVERABLE ATTACHMENTS -->

                                        <ul class="list-unstyled small mt-1">
                                            @foreach (var dd in Model.AttachmentList.Where(y => y.DeliverableId == d.DeliverableId))
                                            {
                                                <li>
                                                    <i class="fa-solid fa-paperclip me-1"></i>
                                                    <a href="#">@dd.Filename </a>
                                                </li>
                                            }

                                        </ul>
                                    </li>
                                }
                            </ul>
                             

                        </div>
                    }          

                        </div>
                    </div>

                    <!-- ACTIONS -->
                    <div class="text-end mt-4">
                        <button class="btn btn-outline-secondary">Edit</button>
                     
                    </div>

                </div>

      


        </div>
    </div>


<style>
    .custom-shadow {
        box-shadow: 0 6px 20px rgba(0,0,0,.06);
    }
</style>


@section scripts {
    <script src="~/js/dci-validation.js"></script>


    <script type="text/javascript">
            var js = jQuery.noConflict(true);
            let _datefrom;
            let _dateto;
                    $('.spinner-overlay').show();

        setTimeout(() => {
            $('.spinner-overlay').hide();
        }, 200);


            $(document).ready(function () {

                    flatpickr("#ActualCompletionDate", {
                                          dateFormat: "m/d/Y",
                                         defaultDate: new Date(),
                                    });


                         flatpickr("#TargetCompletedDate", {
                                      dateFormat: "m/d/Y",
                                       defaultDate: new Date(),
                                    });


            }); //end docu


            function editForm(dataMile){

                console.log(dataMile);

                                  $('#ProjectCreationId').val(dataMile.projectCreationId);
                                $('#MileStoneId').val(dataMile.mileStoneId);
                               $('#MilestoneName').val(dataMile.milestoneName);
                                       $('#Percentage').val(dataMile.percentage);
                                $('#TargetCompletedDate').val(dataMile.targetCompletedDate);
                                  $('#ActualCompletionDate').val(dataMile.actualCompletionDate);
                                  $('#PaymentStatus').val(dataMile.paymentStatus);
                                   $('#Status').val(dataMile.status);
            }



    </script>
}
