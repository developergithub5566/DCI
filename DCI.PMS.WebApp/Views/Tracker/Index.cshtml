@model IEnumerable<DCI.PMS.Models.ViewModel.TrackerViewModel>
@using Newtonsoft.Json;
@using DCI.Core.Common;
@using DCI.Models.ViewModel;


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Task Tracker with Project Details</title>

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

  
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #f4f6f8;
    }

    /* Top Bar */
    .top-bar {
        background: #ffffff;
        padding: 12px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        position: sticky;
        top: 0;
        z-index: 100;
    }

    .app-title {
        font-weight: bold;
        font-size: 18px;
        color: #333;
    }

    .actions {
        display: flex;
        gap: 10px;
    }

    .btn {
        border: none;
        padding: 8px 14px;
        border-radius: 20px;
        font-size: 13px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
        background: #e9ecef;
        color: #333;
    }

    .btn-primary {
        background: #1a73e8;
        color: #fff;
    }

    .btn:hover {
        opacity: 0.9;
    }

    /* Main content */
    .container {
        padding: 20px;
        overflow-x: auto;
    }

    .tracker {
        display: flex;
        gap: 20px;
        min-width: 900px; /* force horizontal scroll if container smaller */
    }

    .column {
        background: #fff;
        border-radius: 8px;
        padding: 10px;
        flex: 1;
        box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        display: flex;
        flex-direction: column;
        max-height: 600px; /* adjust as needed */
    }

    .column h4 {
        text-align: center;
        border-bottom: 1px solid #ddd;
        padding-bottom: 10px;
        flex-shrink: 0;
    }

    /* Scrollable list */
    .task-list {
        overflow-y: auto;
        margin-top: 10px;
        padding-right: 5px; /* for scrollbar spacing */
        flex-grow: 1;
    }

    .task, .project-detail {
        background: #f9fafb;
        padding: 7px;
        border-radius: 6px;
        margin-bottom: 8px; 
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: relative;
        color: #000000;
    }

    .menu-btn {
        cursor: pointer;
        color: #6c757d;
        padding: 6px;
    }

    .menu {
        position: absolute;
        top: 35px;
        right: 10px;
        background: #fff;
        border-radius: 6px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        width: 150px;
        display: none;
        z-index: 10;
    }

    .menu a {
        display: block;
        padding: 8px 12px;
        font-size: 13px;
        text-decoration: none;
        color: #333;
    }

    .menu a:hover {
        background: #f1f1f1;
    }

    .divider {
        height: 1px;
        background: #eee;
        margin: 4px 0;
    }

    /* Status colors */
    .not-started h4 { color: #dc3545; }
    .in-progress h4 { color: #f4b400; }
    .completed h4 { color: #0f9d58; }

    .completed .task {
        color: #6c757d;
        background: #eef1f4;
    }

    /* Project details styling */
    .project-detail {
        font-size: 13px;
        flex-direction: column;
        align-items: flex-start;
    }

    .project-detail span {
        margin-bottom: 4px;

    }
    .details-card {
    position: relative;
}

.details-header {
/*     display: flex; */
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}
</style>
</head>

<body>

    <!-- Top Navigation -->
    <div class="top-bar">
        <div class="app-title"><i class="fa fa-th-list" aria-hidden="true"></i> Task Tracker</div>

        <div class="actions">
            <button class="btn btn-primary" onclick="newTask()">
                <i class="fas fa-plus"></i> New Task
            </button>
         @*    <button class="btn" onclick="showTracker()">
                <i class="fas fa-list"></i> Tracker
            </button> *@
            <button class="btn" onclick="showCalendar()">
                <i class="fas fa-calendar"></i> Calendar
            </button>
        </div>
    </div>

    <!-- Main -->
    <div class="container">

        <div class="tracker">               

            <!-- Not Started -->
            <div class="column not-started">
                <h4>Not Started</h4>
                <div class="task-list">
                    @foreach (var x in Model.Where(x => x.Status == 1))
                    {
                   @*      <a href="#" class="task" onclick='details(@Html.Raw(JsonConvert.SerializeObject(x)))'>
                            @x.MilestoneName
                            <i class="fas fa-ellipsis-v menu-btn"></i>
                            <div class="menu">        
                                <a asp-controller="Project" asp-action="Milestone" asp-route-id="@x.ProjectCreationId">Edit</a>
                                <a href="#">Delete</a>
                                <div class="divider"></div>
                                <a href="#">View Details</a>
                            </div>
                        </a> *@
                        <div class="task">
                            <a href="#" class="task" onclick='details(@Html.Raw(JsonConvert.SerializeObject(x)))'> <strong>@x.MilestoneName</strong> </a>
                            <i class="fas fa-ellipsis-v menu-btn"></i>
                            <div class="menu">
                                <a asp-controller="Project" asp-action="Milestone" asp-route-id="@x.ProjectCreationId" asp-route-mileid="@x.MileStoneId">Edit</a>
                            @*     <a href="#">Delete</a> *@
                          @*       <div class="divider"></div> *@
                              @*   <a href="#">View Details</a> *@
                                <a asp-controller="Project" asp-action="Details" asp-route-id="@x.ProjectCreationId">View Details</a>
                            </div>
                        </div>
                    }
                </div>
            </div>

            <!-- In Progress -->
            <div class="column in-progress">
                <h4>In Progress</h4>
                <div class="task-list">
                    @foreach (var x in Model.Where(x => x.Status == 2))
{
                        <div class="task">

                            <a href="#" class="task" onclick='details(@Html.Raw(JsonConvert.SerializeObject(x)))'> <strong>@x.MilestoneName</strong> </a>
                          
                            <i class="fas fa-ellipsis-v menu-btn"></i>
                            <div class="menu">
                                <a asp-controller="Project" asp-action="Milestone" asp-route-id="@x.ProjectCreationId" asp-route-mileid="@x.MileStoneId">Edit</a>
                      
                            @*     <a href="#">Delete</a> *@
                            @*     <div class="divider"></div> *@
                                <a asp-controller="Project" asp-action="Details" asp-route-id="@x.ProjectCreationId">View Details</a>
                            </div>
                        </div>

                    }
                </div>
           
            </div>

            <!-- Completed -->
            <div class="column completed">
                <h4>Completed</h4>
                <div class="task-list">
                 @foreach (var x in Model.Where(x => x.Status == 3))
                {
                           <div class="task">
                            <a href="#" class="task" onclick='details(@Html.Raw(JsonConvert.SerializeObject(x)))'> <strong>@x.MilestoneName</strong> </a>
                      
                        <i class="fas fa-ellipsis-v menu-btn"></i>
                        <div class="menu">
                                <a asp-controller="Project" asp-action="Details" asp-route-id="@x.ProjectCreationId">View Details</a>
                        </div>
                        </div>
                }
                </div>
            </div>

            <!-- Project Details Column -->
       <div class="column details-card">
                <div class="details-header">
                    <h4>Tracker Detail</h4>
                    <button type="button"
                            class="btn btn-sm btn-outline-primary" 
                            id="btnEditMilestone"
                            onclick="editMilestone()"
                            hidden>
                        <i class="fas fa-edit"></i> Edit
                    </button>

                </div>

                <div class="project-detail">
                    <input type="hidden" id="ProjectCreationId" />
                    <input type="hidden" id="MileStoneId" />
                    <span><strong>Milestone:</strong> <label id="MilestoneName"></label></span>
                    <span><strong>Project:</strong> <label id="ProjectName"></label></span>
                    <span><strong>Owner:</strong> <label id="MilestoneOwnerName"></label></span>
                    <span><strong>Status:</strong> <label id="MilestoneStatusName"></label></span>
                    <span><strong>Target Completed:</strong> <label id="TargetCompletedDate"></label></span>
                    <span><strong>Actual Completion:</strong> <label id="ActualCompletionDate"></label></span>
                    <span><strong>Payment Status:</strong> <label id="PaymentStatusName"></label></span>
                    <span><strong>Percentage:</strong> <label id="Percentage"></label>%</span>
                </div>
          </div>
            
    
        </div>
    </div>

    <script>
        document.querySelectorAll('.menu-btn').forEach(btn => {
            btn.addEventListener('click', function (e) {
                e.stopPropagation();
                document.querySelectorAll('.menu').forEach(m => m.style.display = 'none');
                this.nextElementSibling.style.display = 'block';
            });
        });

        document.addEventListener('click', () => {
            document.querySelectorAll('.menu').forEach(m => m.style.display = 'none');
        });

        function newTask() { alert('Open New Task modal'); }
        function showTracker() { alert('Tracker view'); }
        function showCalendar() { alert('Coming Soon'); }

        function details(x){
            console.log(x)
             $('#ProjectCreationId').text(x.ProjectCreationId);
             $('#MileStoneId').text(x.MileStoneId);
               $('#MilestoneName').text(x.MilestoneName);
               $('#ProjectName').text(x.ProjectName);
                 $('#MilestoneOwnerName').text(x.MilestoneOwnerName);
                   $('#MilestoneStatusName').text(x.MilestoneStatusName);
                  $('#TargetCompletedDate').text(x.TargetCompletedDate);
                   $('#ActualCompletionDate').text(x.ActualCompletionDate); 
                          $('#TargetCompletedDate').text(x.TargetCompletedDate);
                   $('#PaymentStatusName').text(x.PaymentStatusName);
                    $('#Percentage').text(x.Percentage);       
                    
                    // const id = x.ProjectCreationId;
                    // alert(id)
                    if(x.ProjectCreationId >0){
                           $('#btnEditMilestone').show();
                    }else{
                           $('#btnEditMilestone').hide();
                    }
        }

                function editMilestone() {
            const projectId = $('#ProjectCreationId').text().trim();
            const mileid = $('#MileStoneId').text().trim();

            if (!projectId) {
                console.error('ProjectCreationId is missing');
                return;
            }

            let url = `/Project/Milestone/${projectId}`;

            if (mileid && mileid !== '0') {
                url += `?mileid=${mileid}`;
            }

            window.location.href = url;
        }
    </script>

</body>
</html>
